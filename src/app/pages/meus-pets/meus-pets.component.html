<app-navmenu *ngIf="!modal"></app-navmenu>

<div class="area-like-wrapper pets-area">
  <main class="container">
    <div class="top-actions" *ngIf="!modal">
      <button class="btn-back" (click)="voltar()">← Voltar</button>
    </div>
    <h1 class="titulo" *ngIf="!modal">Meus Pets</h1>

    <div *ngIf="carregando" class="card">Carregando...</div>

    <div *ngIf="!carregando && !pets.length" class="card vazio">
      <p>Você ainda não cadastrou nenhum pet.</p>
      <a class="btn" routerLink="/novo-pet">Cadastrar Pet</a>
    </div>

    <section *ngIf="!carregando && pets.length" class="pet-list">
      <article class="pet-card card photo-card glass" *ngFor="let p of pets; let i = index">
        <div class="photo-bg">
          <img class="photo-img" src="{{ p.photoURL || '/imagens/image.png' }}" (error)="onImgError($event)" (load)="onImgLoad(p, i)" alt="{{ p.nome || 'Pet' }}" title="{{ p.nome || 'Pet' }}" />

          <!-- skeleton/loader while image hasn't loaded -->
          <div class="skeleton" *ngIf="!isImageLoaded(p, i)">
            <div class="pulse-circle"></div>
            <div class="pulse-bar"></div>
          </div>

            <div class="top-overlay">
              <h2 class="pet-title pf-poppins" [class.long]="p.nome && p.nome.length > 18">{{ p.nome }}</h2>
              <div class="species-rows">
                <div class="species">{{ p.especie }}</div>
                <div class="raca" *ngIf="p.raca">{{ p.raca }}</div>
              </div>
              <!-- smaller allergy badges placed inside the top overlay (won't overlap other UI) -->
              <div class="alergias-inline" *ngIf="(p._alergiasNormalized || alergiasFor(p)) as alergiasList">
                <ng-container *ngIf="alergiasList.length">
                  <div class="alergia-card glass-small">
                    <div class="alergia-label">Alergias:</div>
                    <div class="alergia-badges">
                      <ng-container *ngFor="let a of alergiasList; let j = index">
                        <span class="alergia-badge small" *ngIf="j < 5">{{ a }}</span>
                      </ng-container>
                      <span class="alergia-badge overflow" *ngIf="alergiasList.length > 5">(... +{{ alergiasList.length - 5 }})</span>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="overlay">
              <div class="meta-right">
                <div class="badges">
                  <span class="badge sexo" *ngIf="p.sexo">{{ p.sexo === 'F' || p.sexo === 'Fêmea' ? '♀' : (p.sexo === 'M' || p.sexo === 'Macho' ? '♂' : p.sexo) }}</span>
                  <span class="badge peso" *ngIf="p.pesoKg">{{ p.pesoKg | number:'1.2-2' }} kg</span>
                  <span class="badge" *ngIf="p.idadeAnos">{{ p.idadeAnos }} anos</span>
                </div>
              </div>
            </div>
        </div>

    <a class="edit-fab" (click)="onEditClick(p)" [class.disabled]="!p.id" [attr.aria-label]="'Editar ' + p.nome">✎</a>

        <div class="pet-body compact">
          <!-- Body left intentionally simple; allergy info shown on image overlay -->
        </div>
      </article>
    </section>

    <div class="paginacao acoes">
      
    </div>
  </main>

  <!-- Floating add pet FAB fixed to bottom-right -->
  <a class="add-pet-fab" routerLink="/novo-pet" aria-label="Adicionar novo pet">+
  </a>

</div>
