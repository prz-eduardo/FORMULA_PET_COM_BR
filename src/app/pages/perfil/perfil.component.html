<app-navmenu *ngIf="!modal"></app-navmenu>

<div class="perfil-wrapper">
  <main class="container">
    <div class="top-actions" *ngIf="!modal">
      <a class="btn btn-sec" routerLink="/area-cliente">← Voltar</a>
    </div>
  <h1 class="titulo" *ngIf="!modal">{{ readOnly ? 'Perfil' : 'Meu Perfil' }}</h1>

    <div *ngIf="carregando" class="card">Carregando...</div>

    <!-- Read-only pretty view -->
    <div class="grid" *ngIf="!carregando && readOnly">
      <section class="card">
        <h2>Informações</h2>
        <div class="info-grid">
          <div class="info-row"><span class="label">Nome</span><span class="value">{{ nome || '-' }}</span></div>
          <div class="info-row"><span class="label">Email</span><span class="value">{{ email || '-' }}</span></div>
          <div class="info-row"><span class="label">Telefone</span><span class="value">{{ telefone || '-' }}</span></div>
          <div class="info-row"><span class="label">CPF</span><span class="value">{{ cpf || '-' }}</span></div>
          <div class="info-row"><span class="label">Nascimento</span><span class="value">{{ dataNascimento || '-' }}</span></div>
          <div class="info-row"><span class="label">Gênero</span><span class="value">{{ genero || '-' }}</span></div>
          <div class="info-row"><span class="label">Estado civil</span><span class="value">{{ estadoCivil || '-' }}</span></div>
          <div class="info-row"><span class="label">Profissão</span><span class="value">{{ profissao || '-' }}</span></div>
        </div>
      </section>

      <section class="card">
        <h2>Endereço</h2>
        <div class="info-grid">
          <div class="info-row"><span class="label">CEP</span><span class="value">{{ endereco.cep || '-' }}</span></div>
          <div class="info-row"><span class="label">Endereço</span><span class="value">{{ endereco.logradouro || '-' }}, {{ endereco.numero || '-' }}</span></div>
          <div class="info-row"><span class="label">Complemento</span><span class="value">{{ endereco.complemento || '-' }}</span></div>
          <div class="info-row"><span class="label">Bairro</span><span class="value">{{ endereco.bairro || '-' }}</span></div>
          <div class="info-row"><span class="label">Cidade/UF</span><span class="value">{{ endereco.cidade || '-' }}/{{ endereco.estado || '-' }}</span></div>
          <div class="info-row"><span class="label">Referência</span><span class="value">{{ endereco.referencia || '-' }}</span></div>
        </div>
        <div class="acoes" style="margin-top:12px">
          <button class="btn btn-sec">Endereços</button>
        </div>
      </section>
    </div>

    <!-- Editable form view -->
    <div class="grid" *ngIf="!carregando && !readOnly">
      <section class="card">
        <h2>Dados do usuário</h2>
        <div class="form-grid">
          <div class="field">
            <label>Nome</label>
            <input [(ngModel)]="nome" />
          </div>
          <div class="field">
            <label>Email</label>
            <input [(ngModel)]="email" type="email" />
            <div class="error" *ngIf="!emailValido">Email inválido</div>
          </div>
          <div class="field">
            <label>Telefone</label>
            <input [(ngModel)]="telefone" mask="(00) 00000-0000" />
          </div>
          <div class="field">
            <label>Telefone secundário</label>
            <input [(ngModel)]="telefoneSecundario" mask="(00) 00000-0000" />
          </div>
          <div class="field">
            <label>CPF</label>
            <input [(ngModel)]="cpf" mask="000.000.000-00" disabled />
          </div>
          <div class="field">
            <label>RG</label>
            <input [(ngModel)]="rg" />
          </div>
          <div class="field">
            <label>Data de Nascimento</label>
            <input [(ngModel)]="dataNascimento" type="date" />
          </div>
          <div class="field">
            <label>Gênero</label>
            <select [(ngModel)]="genero">
              <option value="">Selecione</option>
              <option>Masculino</option>
              <option>Feminino</option>
              <option>Outro</option>
              <option>Prefiro não dizer</option>
            </select>
          </div>
          <div class="field">
            <label>Estado civil</label>
            <select [(ngModel)]="estadoCivil">
              <option value="">Selecione</option>
              <option>Solteiro(a)</option>
              <option>Casado(a)</option>
              <option>Divorciado(a)</option>
              <option>Viúvo(a)</option>
            </select>
          </div>
          <div class="field">
            <label>Profissão</label>
            <input [(ngModel)]="profissao" />
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Endereço</h2>
        <div class="form-grid">
          <div class="field small">
            <label>CEP</label>
            <input [(ngModel)]="endereco.cep" mask="00000-000" (ngModelChange)="onCepInput()" />
            <div class="muted" *ngIf="cepCarregando">Consultando CEP...</div>
          </div>
          <div class="field large">
            <label>Logradouro</label>
            <input [(ngModel)]="endereco.logradouro" />
          </div>
          <div class="field small">
            <label>Número</label>
            <input [(ngModel)]="endereco.numero" />
          </div>
          <div class="field">
            <label>Complemento</label>
            <input [(ngModel)]="endereco.complemento" />
          </div>
          <div class="field">
            <label>Bairro</label>
            <input [(ngModel)]="endereco.bairro" />
          </div>
          <div class="field">
            <label>Cidade</label>
            <input [(ngModel)]="endereco.cidade" />
          </div>
          <div class="field small">
            <label>UF</label>
            <input [(ngModel)]="endereco.estado" maxlength="2" (ngModelChange)="onUfInput()" />
          </div>
          <div class="field">
            <label>Referência</label>
            <input [(ngModel)]="endereco.referencia" />
          </div>
          <div class="field">
            <label>Tipo de endereço</label>
            <select [(ngModel)]="endereco.tipo">
              <option value="">Selecione</option>
              <option value="residencial">Residencial</option>
              <option value="comercial">Comercial</option>
              <option value="outro">Outro</option>
            </select>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Preferências</h2>
        <div class="form-grid">
          <div class="field">
            <label>Método de contato preferido</label>
            <select [(ngModel)]="contatoPreferido">
              <option value="">Selecione</option>
              <option value="email">Email</option>
              <option value="whatsapp">WhatsApp</option>
              <option value="telefone">Telefone</option>
            </select>
          </div>
          <div class="field">
            <label>Horário preferido</label>
            <select [(ngModel)]="horarioPreferido">
              <option value="">Selecione</option>
              <option value="manhã">Manhã</option>
              <option value="tarde">Tarde</option>
              <option value="noite">Noite</option>
            </select>
          </div>
        </div>
        <div class="prefs">
          <label><input type="checkbox" [(ngModel)]="prefEmail" /> Receber comunicações por email</label>
          <label><input type="checkbox" [(ngModel)]="prefWhats" /> Receber mensagens por WhatsApp</label>
          <label><input type="checkbox" [(ngModel)]="prefMarketing" /> Receber ofertas e novidades</label>
          <label><input type="checkbox" [(ngModel)]="prefNotificarPedidos" /> Notificar atualizações de pedidos</label>
          <label><input type="checkbox" [(ngModel)]="prefNotificarReceitas" /> Notificar novas receitas</label>
          <label><input type="checkbox" [(ngModel)]="prefLembrarVacinas" /> Lembrar vacinas dos pets</label>
          <label><input type="checkbox" [(ngModel)]="prefLembrarConsultas" /> Lembrar consultas agendadas</label>
        </div>
      </section>

      <section class="card">
        <h2>Observações</h2>
        <div class="form-grid">
          <div class="field" style="grid-column: 1 / -1;">
            <label>Notas gerais sobre você e seus pets</label>
            <textarea [(ngModel)]="observacoes" rows="4"></textarea>
          </div>
        </div>
      </section>
    </div>

    <div class="acoes" *ngIf="!carregando && !readOnly">
      <a class="btn btn-sec" routerLink="/area-cliente">Cancelar</a>
      <button class="btn" (click)="salvar()" [disabled]="salvando">{{ salvando ? 'Salvando...' : 'Salvar' }}</button>
    </div>
  </main>
</div>
