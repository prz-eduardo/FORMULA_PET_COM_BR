<app-navmenu *ngIf="!modal"></app-navmenu>

<div class="perfil-wrapper">
  <main class="container">
    <div class="top-actions" *ngIf="!modal">
      <a class="btn btn-sec" routerLink="/area-cliente">← Voltar</a>
    </div>
<h1 class="titulo" *ngIf="!modal">{{ readOnly ? 'Perfil' : 'Meu Perfil' }}</h1>

    <div *ngIf="carregando" class="card">Carregando...</div>

    <!-- Profile header with avatar -->
    <div *ngIf="!carregando" class="profile-head">
      <div class="avatar-card card">
      <div class="avatar-wrap" [class.has-pending]="avatarChanged" [class.options-visible]="avatarOptionsVisible">
          <img [src]="avatarSrc()" alt="Avatar" class="avatar"/>
          <label class="avatar-change" title="Editar foto">
            <!-- hidden file input; id used to open programmatically -->
            <input id="perfil-avatar-file" type="file" accept="image/*" (change)="onAvatarSelected($event)" style="display:none" />
            <!-- use the common page edit style so it matches other edit buttons -->
            <button type="button" class="btn icon-pencil" (click)="toggleAvatarOptions()">✏️</button>
          </label>

          <!-- small action list shown when avatarOptionsVisible is true -->
          <div class="avatar-actions" *ngIf="avatarOptionsVisible">
            <button class="btn small danger" (click)="confirmRemoveAvatar()">Excluir foto</button>
            <button class="btn small" (click)="chooseChangeAvatar()">Trocar foto</button>
          </div>

          <!-- when a change is pending, show Cancel / Salvar -->
          <div class="avatar-pending" *ngIf="avatarChanged">
            <button class="btn" (click)="saveAvatarChange()">Salvar</button>
            <button class="btn btn-sec" (click)="cancelAvatarChange()">Cancelar</button>
          </div>
        </div>
      
      </div>
      <div class="profile-actions card">
        <h2>
          <!-- Strict guard: the inline header input appears ONLY when editingNameOnly is active AND
               no other section is being edited. This prevents overlapping edit modes. -->
          <span *ngIf="!(editingNameOnly && editingSection === null)">{{ nome || me?.user?.nome || 'Perfil' }}</span>
          <input class="header-name-input" *ngIf="editingNameOnly && editingSection === null" [(ngModel)]="nome" />
        </h2>
        <div class="quick-actions">
          <!-- Inline name edit is only available when no other section is being edited -->
          <ng-container *ngIf="!editingNameOnly && editingSection === null">
            <button class="btn icon-pencil" title="Editar nome" (click)="editNameOnly()">✏️</button>
          </ng-container>

          <!-- Inline name editing actions (only when no other section is being edited) -->
          <ng-container *ngIf="editingNameOnly && editingSection === null">
            <button class="btn" (click)="saveNameOnly()" [disabled]="salvando">Salvar</button>
            <button class="btn btn-sec" (click)="cancelNameEdit()" title="Cancelar">×</button>
          </ng-container>

          <button class="btn" *ngIf="!readOnly && editingSection === null && !editingNameOnly" (click)="salvar()">Salvar</button>
        </div>
      </div>
    </div>

    <!-- Read-only pretty view -->
    <div class="grid">
      <section id="informacoes-card" class="card" *ngIf="isSectionReadOnlyVisible('informacoes')">
        <header class="section-head">
          <div class="left">
            <h3>Informações</h3>
            <div class="muted">Dados pessoais</div>
          </div>
          <div class="right">
            <ng-container *ngIf="editingSection !== 'informacoes'">
              <button class="btn icon-pencil" title="Editar" (click)="editSection('informacoes')">✏️</button>
            </ng-container>
            <ng-container *ngIf="editingSection === 'informacoes'">
              <button class="btn" (click)="saveSection()">Salvar</button>
              <button class="btn btn-sec" (click)="cancelEditSection()" title="Cancelar">×</button>
            </ng-container>
          </div>
        </header>
        <div class="info-grid">
          <div class="info-row">
            <label class="label">Email</label>
            <div>
              <span class="value" *ngIf="editingSection !== 'informacoes'">{{ email || '-' }}</span>
              <input class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="email" type="email" />
            </div>
          </div>
          <div class="info-row">
            <label class="label">Telefone</label>
            <div>
              <span class="value" *ngIf="editingSection !== 'informacoes'">{{ telefone || '-' }}</span>
              <input class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="telefone" mask="(00) 00000-0000" />
            </div>
          </div>
          <div class="info-row">
            <span class="label">CPF</span>
            <span class="value" *ngIf="editingSection !== 'informacoes'">{{ cpf || '-' }}</span>
            <input class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="cpf" mask="000.000.000-00" disabled />
          </div>
          <div class="info-row">
            <span class="label">Nascimento</span>
            <span class="value" *ngIf="editingSection !== 'informacoes'">{{ dataNascimento || '-' }}</span>
            <input class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="dataNascimento" type="date" />
          </div>
          <div class="info-row">
            <span class="label">Gênero</span>
            <span class="value" *ngIf="editingSection !== 'informacoes'">{{ genero || '-' }}</span>
            <select class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="genero">
              <option value="">Selecione</option>
              <option>Masculino</option>
              <option>Feminino</option>
              <option>Outro</option>
              <option>Prefiro não dizer</option>
            </select>
          </div>
          <div class="info-row">
            <span class="label">Estado civil</span>
            <span class="value" *ngIf="editingSection !== 'informacoes'">{{ estadoCivil || '-' }}</span>
            <select class="inline-input" *ngIf="editingSection === 'informacoes'" [(ngModel)]="estadoCivil">
              <option value="">Selecione</option>
              <option>Solteiro(a)</option>
              <option>Casado(a)</option>
              <option>Divorciado(a)</option>
              <option>Viúvo(a)</option>
            </select>
          </div>
          <div class="info-row">
            <span class="label">Profissão</span>
            <span class="value" *ngIf="editingSection !== 'informacoes'">{{ profissao || '-' }}</span>
            <input class="inline-input"
              *ngIf="editingSection === 'informacoes' && !isPerfilHiddenOnRoute()"
              [(ngModel)]="profissao"
              placeholder="Profissão" title="Informe sua profissão" />
          </div>
        </div>
  </section>

  <section class="card" *ngIf="isSectionReadOnlyVisible('endereco')">
        <header class="section-head">
          <div class="left">
            <h3>Endereço</h3>
            <div class="muted">Endereço principal</div>
          </div>
          <div class="right">
            <ng-container *ngIf="editingSection !== 'endereco'">
              <button class="btn icon-pencil" title="Editar" (click)="editSection('endereco')">✏️</button>
            </ng-container>
            <ng-container *ngIf="editingSection === 'endereco'">
              <button class="btn" (click)="saveSection()">Salvar</button>
              <button class="btn btn-sec" (click)="cancelEditSection()" title="Cancelar">×</button>
            </ng-container>
          </div>
        <!-- Botão '+' para meus endereços: visível no mobile, sempre na parte de baixo do card -->
        <div class="fab-enderecos-mobile">
          <button class="btn fab-enderecos" title="Meus Endereços" (click)="navigate.emit('meus-enderecos')">＋</button>
        </div>
        </header>
        <div class="info-grid">
          <div class="info-row">
            <label class="label">CEP</label>
            <div>
              <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.cep || '-' }}</span>
              <input class="inline-input" *ngIf="editingSection === 'endereco'" [(ngModel)]="endereco.cep" mask="00000-000" (ngModelChange)="onCepInput()" />
            </div>
          </div>
          <div class="info-row">
            <label class="label">Endereço</label>
            <div>
              <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.logradouro || '-' }}, {{ endereco.numero || '-' }}</span>
              <div *ngIf="editingSection === 'endereco'" style="display:flex; gap:8px; align-items:center;">
                <input class="inline-input" style="flex:1" [(ngModel)]="endereco.logradouro" />
                <input class="inline-input" style="width:120px" [(ngModel)]="endereco.numero" />
              </div>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Complemento</span>
            <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.complemento || '-' }}</span>
            <input class="inline-input" *ngIf="editingSection === 'endereco'" [(ngModel)]="endereco.complemento" />
          </div>
          <div class="info-row">
            <span class="label">Bairro</span>
            <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.bairro || '-' }}</span>
            <input class="inline-input" *ngIf="editingSection === 'endereco'" [(ngModel)]="endereco.bairro" />
          </div>
          <div class="info-row">
            <span class="label">Cidade/UF</span>
            <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.cidade || '-' }}/{{ endereco.estado || '-' }}</span>
            <div *ngIf="editingSection === 'endereco'" style="display:flex; gap:8px; align-items:center;">
              <input class="inline-input" style="flex:1" [(ngModel)]="endereco.cidade" />
              <input class="inline-input" style="width:80px" [(ngModel)]="endereco.estado" maxlength="2" (ngModelChange)="onUfInput()" />
            </div>
          </div>
          <div class="info-row">
            <span class="label">Referência</span>
            <span class="value" *ngIf="editingSection !== 'endereco'">{{ endereco.referencia || '-' }}</span>
            <input class="inline-input" *ngIf="editingSection === 'endereco'" [(ngModel)]="endereco.referencia" />
          </div>
        </div>
  </section>

  
  <!-- Preferências & Observações in read-only view -->
  <section class="card" *ngIf="isSectionReadOnlyVisible('preferencias')">
        <header class="section-head">
          <div class="left">
            <h3>Preferências</h3>
            <div class="muted">Como prefere ser contatado e notificações</div>
          </div>
          <div class="right">
            <ng-container *ngIf="editingSection !== 'preferencias'">
              <button class="btn icon-pencil" title="Editar" (click)="editSection('preferencias')">✏️</button>
            </ng-container>
            <ng-container *ngIf="editingSection === 'preferencias'">
              <button class="btn" (click)="saveSection()">Salvar</button>
              <button class="btn btn-sec" (click)="cancelEditSection()" title="Cancelar">×</button>
            </ng-container>
          </div>
        </header>
        <div class="info-grid">
          <div class="info-row">
            <span class="label">Método de contato</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ contatoPreferido || '-' }}</span>
              <select class="inline-input" *ngIf="editingSection === 'preferencias'" [(ngModel)]="contatoPreferido">
                <option value="">Selecione</option>
                <option value="email">Email</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="telefone">Telefone</option>
              </select>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Horário preferido</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ horarioPreferido || '-' }}</span>
              <select class="inline-input" *ngIf="editingSection === 'preferencias'" [(ngModel)]="horarioPreferido">
                <option value="">Selecione</option>
                <option value="manhã">Manhã</option>
                <option value="tarde">Tarde</option>
                <option value="noite">Noite</option>
              </select>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Receber comunicações por email</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefEmail ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefEmail" /> Receber comunicações por email
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Receber mensagens por WhatsApp</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefWhats ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefWhats" /> Receber mensagens por WhatsApp
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Receber ofertas e novidades</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefMarketing ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefMarketing" /> Receber ofertas e novidades
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Notificar atualizações de pedidos</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefNotificarPedidos ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefNotificarPedidos" /> Notificar atualizações de pedidos
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Notificar novas receitas</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefNotificarReceitas ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefNotificarReceitas" /> Notificar novas receitas
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Lembrar vacinas dos pets</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefLembrarVacinas ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefLembrarVacinas" /> Lembrar vacinas dos pets
              </label>
            </div>
          </div>
          <div class="info-row">
            <span class="label">Lembrar consultas agendadas</span>
            <div>
              <span class="value" *ngIf="editingSection !== 'preferencias'">{{ prefLembrarConsultas ? 'Sim' : 'Não' }}</span>
              <label *ngIf="editingSection === 'preferencias'" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" [(ngModel)]="prefLembrarConsultas" /> Lembrar consultas agendadas
              </label>
            </div>
          </div>
        </div>
  </section>

  <section class="card" *ngIf="isSectionReadOnlyVisible('observacoes')">
        <header class="section-head">
          <div class="left">
            <h3>Observações</h3>
            <div class="muted">Notas sobre você e seus pets</div>
          </div>
          <div class="right">
            <ng-container *ngIf="editingSection !== 'observacoes'">
              <button class="btn icon-pencil" title="Editar" (click)="editSection('observacoes')">✏️</button>
            </ng-container>
            <ng-container *ngIf="editingSection === 'observacoes'">
              <button class="btn" (click)="saveSection()">Salvar</button>
              <button class="btn btn-sec" (click)="cancelEditSection()" title="Cancelar">×</button>
            </ng-container>
          </div>
        </header>
        <div class="info-grid">
          <div class="field" style="grid-column:1 / -1">
            <div *ngIf="editingSection !== 'observacoes'" class="value" style="white-space:pre-wrap">{{ observacoes || '-' }}</div>
            <div *ngIf="editingSection === 'observacoes'">
              <textarea class="inline-input" [(ngModel)]="observacoes" rows="6"></textarea>
            </div>
          </div>
        </div>
      </section>
    </div>

  <!-- Editable form view (global edit). Hidden when editing a specific section inline) -->
  <div class="grid" *ngIf="!carregando && !readOnly && editingSection === null">
      <!-- Dados do usuário: show when editingSection is null (global edit) or 'informacoes' -->
      <section class="card" *ngIf="editingSection === null || editingSection === 'informacoes'">
        <h2>Dados do usuário</h2>
        <div class="form-grid">
          <div class="field">
            <label>Nome</label>
            <input [(ngModel)]="nome" />
          </div>
          <div class="field">
            <label>Email</label>
            <input [(ngModel)]="email" type="email" />
            <div class="error" *ngIf="!emailValido">Email inválido</div>
          </div>
          <div class="field">
            <label>Telefone</label>
            <input [(ngModel)]="telefone" mask="(00) 00000-0000" />
          </div>
          <div class="field">
            <label>Telefone secundário</label>
            <input [(ngModel)]="telefoneSecundario" mask="(00) 00000-0000" />
          </div>
          <div class="field">
            <label>CPF</label>
            <input [(ngModel)]="cpf" mask="000.000.000-00" disabled />
          </div>
          <div class="field">
            <label>RG</label>
            <input [(ngModel)]="rg" />
          </div>
          <div class="field">
            <label>Data de Nascimento</label>
            <input [(ngModel)]="dataNascimento" type="date" />
          </div>
          <div class="field">
            <label>Gênero</label>
            <select [(ngModel)]="genero">
              <option value="">Selecione</option>
              <option>Masculino</option>
              <option>Feminino</option>
              <option>Outro</option>
              <option>Prefiro não dizer</option>
            </select>
          </div>
          <div class="field">
            <label>Estado civil</label>
            <select [(ngModel)]="estadoCivil">
              <option value="">Selecione</option>
              <option>Solteiro(a)</option>
              <option>Casado(a)</option>
              <option>Divorciado(a)</option>
              <option>Viúvo(a)</option>
            </select>
          </div>
          <div class="field">
            <label>Profissão</label>
            <input [(ngModel)]="profissao" />
          </div>
        </div>
      </section>

      <!-- Endereço: show when editingSection is null (global edit) or 'endereco' -->
      <section class="card" *ngIf="editingSection === null || editingSection === 'endereco'">
        <h2>Endereço</h2>
        <div class="form-grid">
          <div class="field small">
            <label>CEP</label>
            <input [(ngModel)]="endereco.cep" mask="00000-000" (ngModelChange)="onCepInput()" />
            <div class="muted" *ngIf="cepCarregando">Consultando CEP...</div>
          </div>
          <div class="field large">
            <label>Logradouro</label>
            <input [(ngModel)]="endereco.logradouro" />
          </div>
          <div class="field small">
            <label>Número</label>
            <input [(ngModel)]="endereco.numero" />
          </div>
          <div class="field">
            <label>Complemento</label>
            <input [(ngModel)]="endereco.complemento" />
          </div>
          <div class="field">
            <label>Bairro</label>
            <input [(ngModel)]="endereco.bairro" />
          </div>
          <div class="field">
            <label>Cidade</label>
            <input [(ngModel)]="endereco.cidade" />
          </div>
          <div class="field small">
            <label>UF</label>
            <input [(ngModel)]="endereco.estado" maxlength="2" (ngModelChange)="onUfInput()" />
          </div>
          <div class="field">
            <label>Referência</label>
            <input [(ngModel)]="endereco.referencia" />
          </div>
          <div class="field">
            <label>Tipo de endereço</label>
            <select [(ngModel)]="endereco.tipo">
              <option value="">Selecione</option>
              <option value="residencial">Residencial</option>
              <option value="comercial">Comercial</option>
              <option value="outro">Outro</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Preferências: show when editingSection is null or 'preferencias' -->
      <section class="card" *ngIf="editingSection === null || editingSection === 'preferencias'">
        <h2>Preferências</h2>
        <div class="form-grid">
          <div class="field">
            <label>Método de contato preferido</label>
            <select [(ngModel)]="contatoPreferido">
              <option value="">Selecione</option>
              <option value="email">Email</option>
              <option value="whatsapp">WhatsApp</option>
              <option value="telefone">Telefone</option>
            </select>
          </div>
          <div class="field">
            <label>Horário preferido</label>
            <select [(ngModel)]="horarioPreferido">
              <option value="">Selecione</option>
              <option value="manhã">Manhã</option>
              <option value="tarde">Tarde</option>
              <option value="noite">Noite</option>
            </select>
          </div>
        </div>
        <div class="prefs">
          <label><input type="checkbox" [(ngModel)]="prefEmail" /> Receber comunicações por email</label>
          <label><input type="checkbox" [(ngModel)]="prefWhats" /> Receber mensagens por WhatsApp</label>
          <label><input type="checkbox" [(ngModel)]="prefMarketing" /> Receber ofertas e novidades</label>
          <label><input type="checkbox" [(ngModel)]="prefNotificarPedidos" /> Notificar atualizações de pedidos</label>
          <label><input type="checkbox" [(ngModel)]="prefNotificarReceitas" /> Notificar novas receitas</label>
          <label><input type="checkbox" [(ngModel)]="prefLembrarVacinas" /> Lembrar vacinas dos pets</label>
          <label><input type="checkbox" [(ngModel)]="prefLembrarConsultas" /> Lembrar consultas agendadas</label>
        </div>
      </section>

      <!-- Observações: show when editingSection is null or 'observacoes' -->
      <section class="card" *ngIf="editingSection === null || editingSection === 'observacoes'">
        <h2>Observações</h2>
        <div class="form-grid">
          <div class="field" style="grid-column: 1 / -1;">
            <label>Notas gerais sobre você e seus pets</label>
            <textarea [(ngModel)]="observacoes" rows="4"></textarea>
          </div>
        </div>
      </section>
    </div>
    
    <!-- Account actions: logout and delete account -->
    <div class="acoes" *ngIf="!carregando">
      <button class="btn btn-sec" (click)="logout()">Logout</button>
      <button class="btn danger" (click)="openDeleteAccountModal()" [disabled]="deletingAccount">{{ deletingAccount ? 'Excluindo...' : 'Excluir conta' }}</button>
    </div>

    <!-- Delete / Deactivate account modal with LGPD notice -->
    <div class="modal-overlay" *ngIf="deleteModalOpen">
      <div class="modal-content card" role="dialog" aria-modal="true">
        <header class="modal-header">
          <h3>Desativar conta</h3>
        </header>
        <div class="modal-body">
          <p>
            Ao desativar sua conta, ela será imediatamente desativada. Se não for reativada dentro de 30 dias,
            você perderá o acesso permanentemente e seus dados poderão ser excluídos conforme nossa política de retenção.
          </p>
          <p><strong>O que acontece ao desativar:</strong></p>
          <ul>
            <li>A conta ficará desativada por até 30 dias, período no qual você pode reativá-la.</li>
            <li>Se não reativada em 30 dias, o acesso será perdido e os dados poderão ser removidos ou anonimizados.</li>
            <li>Algumas informações poderão ser retidas por obrigações legais (ex.: fiscais) mesmo após exclusão.</li>
          </ul>
          <p>
            Em conformidade com a LGPD (Lei Geral de Proteção de Dados), você tem direitos sobre seus dados
            (acesso, correção, eliminação, portabilidade, etc.). Antes de confirmar, leia nossa
            <a href="#" (click)="openPrivacyModal(); $event.preventDefault()">Política de Privacidade</a>.
          </p>
          <p style="margin-top:8px;">
            Para habilitar a desativação você precisa ler a Política de Privacidade e clicar em <strong>Concordo</strong>.
          </p>
          <label style="display:flex; align-items:center; gap:8px; margin-top:12px;">
            <input type="checkbox" [checked]="lgpdChecked" disabled />
            Li e concordo com a Política de Privacidade (LGPD).
          </label>
        </div>
        <div class="modal-actions">
          <button class="btn btn-sec" (click)="closeDeleteAccountModal()">Cancelar</button>
          <button class="btn danger" [disabled]="!lgpdChecked || deletingAccount" (click)="confirmDeleteAccountModal()">{{ deletingAccount ? 'Excluindo...' : 'Desativar conta' }}</button>
        </div>
      </div>
    </div>

    <!-- Privacy policy modal (opens from delete modal) -->
    <div class="modal-overlay" *ngIf="privacyModalOpen">
      <div class="modal-content card privacy" role="dialog" aria-modal="true">
        <header class="modal-header">
          <h3>Política de Privacidade</h3>
        </header>
        <div class="modal-body">
          <!-- Short summary / important clauses. Replace or expand with real policy text. -->
          <p><strong>Resumo:</strong> Coletamos e processamos dados pessoais para fornecer os serviços contratados, cumprir obrigações legais e proteger nossos direitos. Você pode solicitar acesso, correção, portabilidade ou eliminação de seus dados conforme previsto na LGPD.</p>
          <p>Seus dados poderão ser retidos por períodos necessários para cumprimento de obrigações legais, fiscais ou para exercício regular de direitos.</p>
          <div style="max-height:40vh; overflow:auto; padding:8px; border-radius:8px; background:rgba(0,0,0,0.02); margin-top:8px;">
            <p><em>Política completa (exemplo):</em></p>
            <p>— Coleta: Nome, email, telefone, histórico de compras, etc.</p>
            <p>— Finalidade: Processamento de pedidos, atendimento, notificações e melhorias.</p>
            <p>— Compartilhamento: Com parceiros de logística, pagamentos e conforme exigido por lei.</p>
            <p>— Direitos: Acesso, correção, anonimização, eliminação, portabilidade, revogação do consentimento.</p>
            <p>Para ver a versão completa da Política, acesse a página dedicada ou contate nosso DPO.</p>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-sec" (click)="closePrivacyModal()">Fechar</button>
          <button class="btn primary" (click)="agreePrivacy()">Concordo</button>
        </div>
      </div>
    </div>
  </main>
</div>
