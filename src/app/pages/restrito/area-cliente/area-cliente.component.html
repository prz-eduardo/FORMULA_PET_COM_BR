<app-navmenu *ngIf="!modal"></app-navmenu>

<div class="area-cliente-wrapper" *ngIf="ready; else carregandoEstado">
  <h1 class="titulo">{{ titulo }}</h1>

  <!-- Login / Criar Conta -->
  <div *ngIf="!hasAuth" class="card login-card">
    <h2>Bem-vindo(a)!</h2>
    <p>Faça login ou crie sua conta para acessar os recursos.</p>
    <div class="acoes">
      <button class="btn" (click)="abrirModalLogin()">Login</button>
      <button class="btn btn-sec" (click)="abrirModalCadastro()">Criar Conta</button>
    </div>
  </div>

  <!-- Painel Cliente -->
  <div *ngIf="hasAuth && internalView !== 'perfil'" class="cliente-panel">
    <div class="cliente-info" style="display:flex;justify-content:center;align-items:center;width:100%;">
      <span class="cliente-nome">{{ clienteData?.nome }}</span>
    </div>
  </div>

  <!-- Navegação interna quando em modal: barra de voltar -->
  <div *ngIf="modal && internalView" class="internal-back">
  <button class="btn btn-sec" (click)="goBack()" aria-label="Voltar">Voltar</button>
  </div>

  <!-- Widgets do Cliente -->
  <div class="menu-wrapper" *ngIf="hasAuth && (!modal || !internalView)">
    <div class="menu-cards-wrapper">
      <!-- Perfil primeiro -->
      <div class="menu-card" (click)="open('perfil')">
        <div class="card-icon">👤</div>
        <div class="card-title">Perfil</div>
      </div>
      <div class="menu-card" (click)="open('meus-pedidos')">
        <div class="card-icon">📦</div>
        <div class="card-title">Meus Pedidos</div>
      </div>
      <div class="menu-card" (click)="open('meus-pets')">
        <div class="card-icon">🐶🐱</div>
        <div class="card-title">Meus Pets</div>
      </div>
      <div class="menu-card" (click)="open('meus-enderecos')">
        <div class="card-icon">🏠</div>
        <div class="card-title">Endereços</div>
      </div>
      <!-- Removed: Cadastrar Pet, Favoritos and Carrinho per request -->
      <!-- Logout button - matches existing menu-card style -->
      <div class="menu-card" (click)="openLogoutModal()" title="Sair da conta">
        <div class="card-icon">🚪</div>
        <div class="card-title">Logout</div>
      </div>
    </div>

    <!-- overlay se algum widget estiver bloqueado -->
    <div *ngIf="!clienteData?.ativo" class="overlay-vidro-real"></div>
  </div>

  <!-- Pets removidos desta visão; aparecerão somente ao abrir "Meus Pets" -->

  <!-- Modais -->
  <ng-container *ngIf="modalLoginAberto">
    <div class="modal-overlay" (click)="fecharModalLogin()"></div>
    <div class="modal-content">
      <div (click)="$event.stopPropagation()">
        <app-login-cliente (close)="fecharModalLogin()" (loggedIn)="onLogin()"></app-login-cliente>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="modalCadastroAberto">
    <div class="modal-overlay" (click)="fecharModalCadastro()"></div>
    <div class="modal-content">
      <div (click)="$event.stopPropagation()">
  <app-crie-sua-conta-cliente (close)="fecharModalCadastro()" (loggedIn)="onLogin()"></app-crie-sua-conta-cliente>
      </div>
    </div>
  </ng-container>
  
  <!-- Logout confirmation modal -->
  <ng-container *ngIf="modalLogoutAberto">
    <div class="modal-overlay" (click)="closeLogoutModal()"></div>
    <div class="modal-content">
      <div (click)="$event.stopPropagation()" style="padding:18px; max-width:420px; text-align:left;">
        <h3 style="margin-top:0;">Confirmar logout</h3>
        <p>Tem certeza que deseja sair da sua conta? Você será desconectado desta sessão.</p>
        <div class="modal-actions">
          <button class="btn btn-sec btn-cancel" (click)="closeLogoutModal()">Cancelar</button>
          <button class="btn btn-confirm" (click)="confirmLogout()">Sair</button>
        </div>
      </div>
    </div>
  </ng-container>
  
  <!-- Host interno para subviews quando em modal -->
  <ng-template #internalHost></ng-template>
  <!-- Host sobreposto para modais internos (ex: consultar pedidos) -->
  <ng-template #overlayHost></ng-template>
</div>

<ng-template #carregandoEstado>
  <div class="area-cliente-wrapper">
    <h1 class="titulo">Área do Cliente 🐾</h1>
    <div class="card login-card">Inicializando...</div>
  </div>
</ng-template>
