<div class="area-like-wrapper">
  <div class="container">
    <div class="top-actions">
      <h1 class="titulo">Meus Endereços</h1>
      <div class="spacer"></div>
  <button class="btn" (click)="addEndereco()">Adicionar endereço</button>
  <div class="loader" *ngIf="loading">Carregando...</div>
    </div>

    <div class="address-list">
  <div class="address-card" *ngFor="let e of enderecos">
        <div class="card-head">
          <div class="card-left">
            <span class="emoji">{{ tipoEmoji(e.tipo) }}</span>
          </div>
          <div class="card-main">
            <div class="label">{{ e.label }}</div>
            <div class="rua">{{ e.logradouro }}{{ e.numero ? ', ' + e.numero : '' }}</div>
            <div class="meta">{{ e.cidade }} - {{ e.estado }} • {{ e.cep }}</div>
          </div>
          <div class="card-actions">
            <button class="icon edit" (click)="$event.stopPropagation(); openDetails(e, true)" title="Editar">✏️</button>
            <button class="icon del" (click)="$event.stopPropagation(); confirmDelete(e)">🗑️</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Details modal (replicated style from Area Cliente) -->
  <ng-container *ngIf="detailOpen">
    <div class="modal-overlay" (click)="closeDetails()"></div>
    <div class="modal-content">
      <button class="close-floating" (click)="closeDetails()" aria-label="Fechar">✕</button>
      <div class="modal-body" (click)="$event.stopPropagation()">
        <header>
          <h3>
            {{ editing ? (editModel.label || 'Novo Endereço') : (selected?.label || 'Endereço') }}
            <span *ngIf="editing && editModel.label?.length > 0 && editModel.label?.length < 3" class="label-invalid"> — nome muito curto</span>
          </h3>
          <div class="header-actions">
            <button *ngIf="!editing" class="btn small" (click)="enableEdit()">Editar</button>
            <!-- close moved to floating corner for cleaner layout -->
          </div>
        </header>
        <div class="body">
        <div *ngIf="!editing">
          <div class="kv"><div class="k">Rua</div><div class="v">{{ selected?.rua }}</div></div>
          <div class="kv"><div class="k">Cidade</div><div class="v">{{ selected?.cidade }}</div></div>
          <div class="kv"><div class="k">UF</div><div class="v">{{ selected?.uf }}</div></div>
          <div class="kv"><div class="k">CEP</div><div class="v">{{ selected?.cep }}</div></div>
        </div>
        <div *ngIf="editing">
          <!-- Floating label field for the address name -->
          <div class="floating">
            <input id="labelInput" placeholder=" " [(ngModel)]="editModel.label" />
            <label for="labelInput">Nome do endereço</label>
          </div>
          <label>CEP<input [(ngModel)]="editModel.cep" (input)="onCepInputMask($event)" (blur)="onCepBlurLookup()" /></label>
          <div class="cep-loader" *ngIf="cepCarregando" aria-live="polite" aria-label="Consultando CEP">
            <div class="dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <label>Rua<input [(ngModel)]="editModel.logradouro" /></label>
          <label>Número<input [(ngModel)]="editModel.numero" /></label>
          <label>Complemento<input [(ngModel)]="editModel.complemento" /></label>
          <label>Bairro<input [(ngModel)]="editModel.bairro" /></label>
          <label>Cidade<input [(ngModel)]="editModel.cidade" /></label>
          <label>UF<input maxlength="2" [(ngModel)]="editModel.estado" /></label>
          <div class="tipo-row">
            <button type="button" class="pill" [class.on]="editModel.tipo === 'casa'" (click)="editModel.tipo='casa'" aria-label="Casa" data-tip="Casa"><span class="emoji">🏠</span><span class="tip">Casa</span></button>
            <button type="button" class="pill" [class.on]="editModel.tipo === 'trabalho'" (click)="editModel.tipo='trabalho'" aria-label="Trabalho" data-tip="Trabalho"><span class="emoji">💼</span><span class="tip">Trabalho</span></button>
            <button type="button" class="pill" [class.on]="editModel.tipo === 'entrega'" (click)="editModel.tipo='entrega'" aria-label="Entrega" data-tip="Entrega"><span class="emoji">📦</span><span class="tip">Entrega</span></button>
            <button type="button" class="pill" [class.on]="editModel.tipo === 'cobranca'" (click)="editModel.tipo='cobranca'" aria-label="Cobrança" data-tip="Cobrança"><span class="emoji">🧾</span><span class="tip">Cobrança</span></button>
            <button type="button" class="pill" [class.on]="editModel.tipo === 'outros'" (click)="editModel.tipo='outros'" aria-label="Outros" data-tip="Outros"><span class="emoji">📍</span><span class="tip">Outros</span></button>
          </div>
        </div>
      </div>
        <div class="modal-actions">
          <button class="btn btn-sec btn-cancel" *ngIf="editing" (click)="cancelEdit()">Cancelar</button>
          <button class="btn btn-confirm" *ngIf="editing" (click)="saveEdit()">Salvar</button>
          <button class="btn btn-confirm" *ngIf="!editing" (click)="enableEdit()">Editar</button>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Delete confirm modal -->
  <div class="overlay" *ngIf="confirmOpen">
    <div class="confirm-modal">
      <div class="body">Realmente deseja apagar esse endereço?</div>
      <div class="actions">
        <button class="btn btn-sec" (click)="confirmOpen=false">Cancelar</button>
        <button class="btn" (click)="doDeleteConfirmed()">Apagar</button>
      </div>
    </div>
  </div>
</div>