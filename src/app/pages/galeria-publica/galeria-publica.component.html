<app-navmenu></app-navmenu>

<main class="galeria-container container">
  <header class="galeria-header">
  <h1 class="galeria-title">Galeria üêæ</h1>
    <p class="galeria-subtitle">Uma curadoria carinhosa das melhores fotos da nossa comunidade. Veja, emocione-se e espalhe afeto.</p>
    <div class="galeria-actions">
      <button class="btn btn-primary btn-go-meus-pets" (click)="openAreaClienteMeusPets()" aria-label="Ir para meus pets">Ir para meus pets</button>
    </div>
  </header>

  <div *ngIf="loading" class="card">Carregando galeria...</div>
  <div *ngIf="error" class="card danger">{{ error }}</div>

  <div class="masonry">
  <div *ngFor="let p of pets" class="masonry-item" [ngClass]="[p.size, (p.type === 'vet_ad' ? 'vet-ad' : '')]">
      <ng-container *ngIf="p.type === 'vet_ad'; else regularPet">
        <!-- Veterinarian ad: special standalone layout -->
        <article class="vet-ad-card" role="article" aria-label="An√∫ncio Veterin√°rio">
          <div class="vet-ad-inner">
            <div class="vet-ad-badge">AN√öNCIO VETERIN√ÅRIO</div>
            <div class="photo-wrap vet-photo-wrap">
        <img [src]="p.foto || p.photo || p.photoURL || '/imagens/image.png'" alt="Foto do veterin√°rio {{ p.nome }}" class="vet-photo"
          (error)="onImgError($event.target, '/imagens/image.png')" />
            </div>
            <div class="vet-ad-body">
              <h3 class="vet-name">{{ p.nome || p.name || 'Veterin√°rio' }}</h3>
              <p class="vet-promo" *ngIf="p.promo_text">{{ p.promo_text }}</p>
              <div class="vet-contact">
                <a *ngIf="p.telefone" class="vet-contact-link vet-phone" href="tel:{{ p.telefone }}">üìû {{ p.telefone }}</a>
                <a *ngIf="p.email" class="vet-contact-link vet-email" href="mailto:{{ p.email }}">‚úâÔ∏è {{ p.email }}</a>
              </div>
              <div class="vet-meta">
                <span class="vet-plan">Plano: {{ p.plan }}</span>
              </div>
            </div>
          </div>
        </article>
      </ng-container>
      <ng-template #regularPet>
        <!-- Regular pet card -->
        <div class="card">
      <div class="photo-wrap">
  <img [src]="p.foto || p.photo || p.photoURL || '/imagens/image.png'" alt="Foto do pet" class="pet-photo"
  (error)="onImgError($event.target, '/imagens/image.png')" (click)="onPhotoClick(p, $event)" />
            <div class="overlay">
              <div class="overlay-top">
                <div class="pet-type" [attr.aria-label]="(p.tipo || p.especie || 'Pet')">{{ typeEmoji(p.tipo || p.especie) }}</div>
                <div class="pet-age">{{ (p.idade || p.age) ? (p.idade || p.age) + ' anos' : '' }}</div>
              </div>
              <div class="overlay-bottom">
                <div class="pet-name" [class.shifted]="reactionPickerOpenFor === p._uid">{{ p.nome || p.name || 'Sem nome' }}</div>
                <div class="actions">
                  <!-- actions left intentionally empty; reaction UI moved outside photo-wrap to avoid clipping -->
                </div>
              </div>
            </div>
          </div>
        <!-- place the reaction button/picker outside of the photo-wrap so it can overflow and remain visible -->
        <div class="reaction-wrapper" [attr.data-pet-id]="p._uid">
          <button class="btn-like" [class.visualActive]="p._visualActive" (click)="openReactionPicker(p, p._uid, $event)">
            {{ p.userReactionTipo ? getReactionEmoji(p.userReactionTipo) : '\u2764\ufe0f' }}
            <div class="likes-total" [class.has-my-like]="p._visualActive">{{ p.likes ?? 0 }}</div>
          </button>
          <div class="reaction-picker" *ngIf="reactionPickerOpenFor === p._uid" (click)="$event.stopPropagation()" [class.flipped]="pickerFlippedFor === p._uid">
            <div class="reaction-row">
              <button *ngFor="let r of reactionTypes; let i = index" class="reaction-btn" (click)="selectReaction(p, r.tipo)" [attr.aria-label]="r.tipo" [style.--d]="(i + 1) * 100 + 'ms'" [style.--exit-d]="(i + 1) * 100 + 'ms'" [class.selected]="(p._pickerSelectedConfirmed === true) && (p.userReactionTipo === r.tipo)" [class.preview]="p._pickerAutoHighlight === r.tipo" [class.confirm]="p._pickerConfirm === r.tipo" [class.exiting]="p._pickerExiting">
                <span class="emoji">{{ r.emoji }}</span>
                <span class="reaction-count" aria-hidden="true">{{ (p.reactionTotals && (p.reactionTotals[r.tipo] ?? 0)) || 0 }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      </ng-template>
    </div>
  </div>

  <div class="loading-more" *ngIf="loadingMore">Carregando mais pets‚Ä¶</div>
  <div #sentinel class="sentinel" aria-hidden="true"></div>

</main>

<app-footer></app-footer>
